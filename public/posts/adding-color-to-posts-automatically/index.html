<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Generating Colors from Post Titles | My New Hugo Site</title>

    <link rel="stylesheet" href="/css/main.css">


      <script src="/js/main.js"></script>


</head>
<body>
  <header>
    <div class="container">
    <div class="site-title">
        <svg id="header-logo" width="50" height="30" xmlns="http://www.w3.org/2000/svg">
            <circle cx="15" cy="15" r="10" fill="#fcfcfc" stroke="#202225" stroke-width="1" />
            <circle cx="25" cy="15" r="10" fill="#202225" stroke="#fcfcfc" stroke-width="1" />
        </svg>
        <div class="site-url">
            <span class="header-url">invisibleparade.com</span>
        </div>
    </div>
</div>

  </header>
  <nav>
  	<div class="container">
    <ul>
        <li><a href="/">Index</a></li>
        <li><a href="/posts">Posts</a></li>
        <li><a href="/notes">Notes</a></li>
        <li><a href="/links">Links</a></li>
        <li><a href="/micro">Micro</a></li>
    </ul>
</div>

  </nav>
  <main>
    
  <h1>Generating Colors from Post Titles</h1>

  
  
  <time datetime="2019-03-20T00:00:00&#43;00:00">March 20, 2019</time>

  <p>This blog has an intentionally simple design, but lately I&rsquo;ve been thinking that it needs more color. A lot of the posts don&rsquo;t have images and are just text, so large areas of the page are black and white with nothing visually interesting. That said, trying to include an image with every post is a pain. I would probably spend more time browsing stock images than actually writing the posts.</p>
<p><a href="https://picular.co">Picular</a> was a big inspiration. Generating colors from text by searching for images is a great idea, and I decided to automatically get a set of colors based on each post&rsquo;s title. Picular doesn&rsquo;t have an API that I could use, so I wrote a quick script that does something similar. Unless I&rsquo;ve changed things since I published this post, there should now be a row of colors next to each post&rsquo;s title.</p>
<h2 id="getting-colors-from-images">Getting colors from images</h2>
<p>I&rsquo;ve included the script itself at the end of the post so you can the details of how it works, but the general process is as follows:</p>
<ol>
<li>Do a Google Image search for the title of the post</li>
<li>Get the first five images</li>
<li>For each image, find the color that is most prominent</li>
<li>Save the list of colors to the post</li>
</ol>
<p>Here are the results for the title &ldquo;My Vacation in Tahiti&rdquo;:</p>
<table>
  <tr>
    <td style="text-align:center"><img src="images/tahiti1.jpg" /></td>
    <td style="text-align:center"><img src="images/tahiti2.jpg" /></td>
    <td style="text-align:center"><img src="images/tahiti3.jpg" /></td>
    <td style="text-align:center"><img src="images/tahiti4.jpg" /></td>
    <td style="text-align:center"><img src="images/tahiti5.jpg" /></td>
  </tr>
  <tr>
    <td style="width:20%;text-align:center;background-color:#626E6F;color:white">#626E6F</td>
    <td style="width:20%;text-align:center;background-color:#53C2D6">#53C2D6</td>
    <td style="width:20%;text-align:center;background-color:#7693C6">#7693C6</td>
    <td style="width:20%;text-align:center;background-color:#39547B;color:white">#39547B</td>
    <td style="width:20%;text-align:center;background-color:#515E65;color:white">#515E65</td>
  </tr>
</table>
<br />
<p>After playing around with it, I found that just looking at the most frequently used color usually isn&rsquo;t good enough. Most of the time you just end up with a lot of black and white. Instead of looking for the most common color, I should instead look for the most interesting color. There is a lot of room for optimization here, and Picular probably does a lot behind the scenes to make its results visually appealing. For now, I&rsquo;m just ignoring any colors that are close to black or close to white. So far it&rsquo;s working well enough for my uses.</p>
<p>Even with these adjustments, this method tends to find a lot of colors that are either very dark or very bright. The colors often felt too strong compared to the rest of the site&rsquo;s design. I thought about doing some adjustments to the colors to tone them down, but realized that it&rsquo;s much easier to cheat by reducing the opacity of the colorful bars via CSS.</p>
<p>I now also include this script in the rake task that generates my post files for Jekyll, so after I write a post it will automatically fetch colors before publishing. I might write another post about how that works, but for now you can see the file <a href="https://github.com/aonsager/aonsager.github.io/blob/master/Rakefile">here</a> (sorry if I&rsquo;ve changed things since I wrote this and it&rsquo;s no longer there).</p>
<!-- more -->
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li><a href="https://cse.google.com/cse/create/new">Create a custom search engine</a> powered by google</li>
<li><a href="https://developers.google.com/custom-search/v1/overview">Get an API key</a> for the Custom Search JSON API</li>
</ul>
<p>This is the only good way that I have found to get image search results without using a credit card. The custom search engine requires that you specify a site to search when you create it, but you can change the settings to search the entire web afterwards and it works fine.</p>
<h2 id="the-script">The Script</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;net/https&#39;</span>
</span></span><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;uri&#39;</span>
</span></span><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;json&#39;</span>
</span></span><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;yaml&#39;</span>
</span></span><span style="display:flex;"><span>require <span style="color:#e6db74">&#39;rmagick&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">CONFIG</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">YAML</span><span style="color:#f92672">.</span>load_file(<span style="color:#e6db74">&#34;_local_config.yml&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Does an image search for the post title</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># and returns 5 prominent colors</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">colors_from_title</span>(title)
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Make the search query</span>
</span></span><span style="display:flex;"><span>  uri  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://www.googleapis.com&#34;</span>
</span></span><span style="display:flex;"><span>  path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/customsearch/v1&#34;</span>
</span></span><span style="display:flex;"><span>  uri <span style="color:#f92672">=</span> <span style="color:#66d9ef">URI</span>(uri <span style="color:#f92672">+</span> path <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;?key=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#66d9ef">CONFIG</span><span style="color:#f92672">[</span><span style="color:#e6db74">&#39;google_api_key&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;&amp;q=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#66d9ef">URI</span><span style="color:#f92672">.</span>escape(title) <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;&amp;cx=&#34;</span> <span style="color:#f92672">+</span> <span style="color:#66d9ef">CONFIG</span><span style="color:#f92672">[</span><span style="color:#e6db74">&#39;search_cx&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;&amp;searchType=image&amp;num=5&#34;</span>)
</span></span><span style="display:flex;"><span>  request <span style="color:#f92672">=</span> <span style="color:#66d9ef">Net</span><span style="color:#f92672">::</span><span style="color:#66d9ef">HTTP</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Get</span><span style="color:#f92672">.</span>new(uri)
</span></span><span style="display:flex;"><span>  response <span style="color:#f92672">=</span> <span style="color:#66d9ef">Net</span><span style="color:#f92672">::</span><span style="color:#66d9ef">HTTP</span><span style="color:#f92672">.</span>start(
</span></span><span style="display:flex;"><span>    uri<span style="color:#f92672">.</span>host, uri<span style="color:#f92672">.</span>port, <span style="color:#e6db74">:use_ssl</span> <span style="color:#f92672">=&gt;</span> uri<span style="color:#f92672">.</span>scheme <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;https&#39;</span>
</span></span><span style="display:flex;"><span>  ) <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>http<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>    http<span style="color:#f92672">.</span>request(request)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Get the image results.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Using the thumbnails makes processing faster</span>
</span></span><span style="display:flex;"><span>  image_urls <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>  parsed_json <span style="color:#f92672">=</span> <span style="color:#66d9ef">JSON</span><span style="color:#f92672">.</span>parse(response<span style="color:#f92672">.</span>body)
</span></span><span style="display:flex;"><span>  parsed_json<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;items&#39;</span><span style="color:#f92672">].</span>each <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>item<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>    image_urls <span style="color:#f92672">&lt;&lt;</span> item<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;image&#39;</span><span style="color:#f92672">][</span><span style="color:#e6db74">&#39;thumbnailLink&#39;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Process each image and get its most dominant color</span>
</span></span><span style="display:flex;"><span>  colors <span style="color:#f92672">=</span> <span style="color:#f92672">[]</span>
</span></span><span style="display:flex;"><span>  image_urls<span style="color:#f92672">.</span>each <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>image_url<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>    original <span style="color:#f92672">=</span> <span style="color:#66d9ef">Magick</span><span style="color:#f92672">::</span><span style="color:#66d9ef">Image</span><span style="color:#f92672">.</span>read(image_url)<span style="color:#f92672">.</span>first
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Reduce to 16 colors to speed up processing</span>
</span></span><span style="display:flex;"><span>    q <span style="color:#f92672">=</span> original<span style="color:#f92672">.</span>quantize(<span style="color:#ae81ff">16</span>, <span style="color:#66d9ef">Magick</span><span style="color:#f92672">::</span><span style="color:#66d9ef">RGBColorspace</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Sort colors in order of frequency</span>
</span></span><span style="display:flex;"><span>    palette <span style="color:#f92672">=</span> q<span style="color:#f92672">.</span>color_histogram<span style="color:#f92672">.</span>sort {<span style="color:#f92672">|</span>a, b<span style="color:#f92672">|</span> b<span style="color:#f92672">[</span><span style="color:#ae81ff">1</span><span style="color:#f92672">]</span> <span style="color:#f92672">&lt;=&gt;</span> a<span style="color:#f92672">[</span><span style="color:#ae81ff">1</span><span style="color:#f92672">]</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Default to most common value, will try to replace</span>
</span></span><span style="display:flex;"><span>    color <span style="color:#f92672">=</span> q<span style="color:#f92672">.</span>to_color(palette<span style="color:#f92672">[</span><span style="color:#ae81ff">0</span><span style="color:#f92672">][</span><span style="color:#ae81ff">0</span><span style="color:#f92672">]</span>)
</span></span><span style="display:flex;"><span>    palette<span style="color:#f92672">.</span>each <span style="color:#66d9ef">do</span> <span style="color:#f92672">|</span>p<span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>      pixel <span style="color:#f92672">=</span> p<span style="color:#f92672">[</span><span style="color:#ae81ff">0</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>      hsl <span style="color:#f92672">=</span> pixel<span style="color:#f92672">.</span>to_HSL
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> hsl<span style="color:#f92672">[</span><span style="color:#ae81ff">2</span><span style="color:#f92672">]</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Skip this color because too dark</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">next</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">elsif</span> hsl<span style="color:#f92672">[</span><span style="color:#ae81ff">2</span><span style="color:#f92672">]</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">.</span><span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Skip this color because too light</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">next</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Use this color</span>
</span></span><span style="display:flex;"><span>        color <span style="color:#f92672">=</span> q<span style="color:#f92672">.</span>to_color(pixel)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>    colors <span style="color:#f92672">&lt;&lt;</span> color
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>  colors
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span>
</span></span></code></pre></div>
  
  <div>
    <div>Tags:</div>
    <ul>
        <li><a href="/tags/design/">Design</a></li>
        <li><a href="/tags/blog/">Blog</a></li>
        <li><a href="/tags/color/">Color</a></li>
        <li><a href="/tags/tool/">Tool</a></li>
        <li><a href="/tags/automation/">Automation</a></li>
    </ul>
  </div>


  </main>
  <footer>
    <p>Copyright 2026. All rights reserved.</p>

  </footer>
</body>
</html>
